<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2D Proximity Voice</title>
<style>
  body {
    margin: 0;
    background: radial-gradient(circle at top, #0f172a, #020617);
    font-family: 'Segoe UI', sans-serif;
    color: #e5e7eb;
    overflow: hidden;
  }
  canvas {
    display: block;
    background: #0f172a;
  }
  #info {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 16px;
    background: rgba(0,0,0,0.4);
    padding: 8px 12px;
    border-radius: 8px;
  }
</style>
</head>
<body>
<div id="info">ðŸŽ§ Klicke einen Spieler, um gezielt Voice zu hÃ¶ren</div>
<canvas id="gameCanvas"></canvas>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener("resize", () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

// Socket.IO
const socket = io();

// Spieler Daten
let players = {}; // id -> {x, y, name, selected}
let localPlayer = {x: 0, y: 0, id: "me"};

// Maus Klick fÃ¼r gezieltes HÃ¶ren
canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  for (let id in players) {
    const p = players[id];
    const px = p.x + canvas.width/2;
    const py = p.y + canvas.height/2;
    const dist = Math.hypot(mx - px, my - py);
    if (dist < 20) {
      p.selected = !p.selected;
      console.log("ðŸŽ¤ Selected player:", p.name, p.selected);
    }
  }
});

// Dummy Roblox Position Updater (hier wÃ¼rdest du echte Werte nehmen)
setInterval(() => {
  // z.B. random Bewegung
  localPlayer.x += Math.random()*4 - 2;
  localPlayer.y += Math.random()*4 - 2;
  socket.emit("updatePosition", {position: {x: localPlayer.x, y: 0, z: localPlayer.y}});
}, 100);

// Canvas Draw Loop
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Eigener Spieler
  ctx.fillStyle = "#0ff";
  ctx.beginPath();
  ctx.arc(canvas.width/2, canvas.height/2, 15, 0, Math.PI*2);
  ctx.fill();
  ctx.fillText("Du", canvas.width/2-10, canvas.height/2-20);

  // Andere Spieler
  for (let id in players) {
    const p = players[id];
    const screenX = canvas.width/2 + (p.x - localPlayer.x)*5;
    const screenY = canvas.height/2 + (p.z - localPlayer.y)*5;

    ctx.beginPath();
    ctx.arc(screenX, screenY, p.selected ? 20 : 12, 0, Math.PI*2);
    ctx.fillStyle = p.selected ? "#ff0" : "#f00";
    ctx.fill();

    ctx.fillStyle = "#fff";
    ctx.font = "12px sans-serif";
    ctx.fillText(p.name, screenX - 10, screenY - 15);
  }

  requestAnimationFrame(draw);
}
draw();

// Socket.IO: Positionen vom Server bekommen
socket.on("updatePlayers", (data) => {
  players = data; // {id: {x,y,z,name}}
});

// Incoming Voice
socket.on("voice", ({audio, volume}) => {
  const a = new Audio("data:audio/webm;base64," + audio);
  a.volume = volume;
  a.play();
});
</script>
</body>
</html>
